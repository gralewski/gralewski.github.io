<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stationeers Gas Tuning Helper</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #1a1a1a;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #eee;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      color: #fff;
    }
    .instructions {
      background: #252525;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #4477ff;
    }
    .instructions h3 {
      margin-bottom: 10px;
      color: #4477ff;
    }
    .instructions ol {
      margin-left: 20px;
    }
    .instructions li {
      margin: 5px 0;
    }
    .gas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .gas-card {
      background: #252525;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #333;
    }
    .gas-card h2 {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .gas-symbol {
      display: inline-block;
      width: 30px;
      height: 30px;
      border-radius: 4px;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
    }
    .input-group {
      margin-bottom: 15px;
    }
    .input-group label {
      display: block;
      margin-bottom: 5px;
      color: #aaa;
      font-size: 13px;
    }
    .input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    .input-col {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .input-col label {
      font-size: 11px;
      color: #888;
      font-weight: bold;
    }
    .input-field {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .input-field input {
      flex: 1;
      padding: 8px;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
    }
    .input-field input:focus {
      outline: none;
      border-color: #4477ff;
    }
    .input-field span {
      color: #888;
      font-size: 12px;
      min-width: 25px;
    }
    .temp-info {
      font-size: 11px;
      color: #666;
      margin-top: 3px;
    }
    .result {
      background: #1a1a1a;
      padding: 10px;
      border-radius: 4px;
      margin-top: 15px;
      border: 1px solid #444;
    }
    .result-label {
      font-size: 11px;
      color: #888;
      margin-bottom: 5px;
    }
    .result-values {
      display: flex;
      gap: 15px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .result-values span {
      color: #4477ff;
    }
    .output-section {
      background: #252525;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #4477ff;
    }
    .output-section h2 {
      margin-bottom: 15px;
      color: #4477ff;
    }
    .code-output {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 4px;
      border: 1px solid #444;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      color: #ddd;
      white-space: pre;
      overflow-x: auto;
    }
    .copy-button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #4477ff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    .copy-button:hover {
      background: #5588ff;
    }
    .copy-button:active {
      background: #3366dd;
    }
    .status {
      margin-top: 10px;
      padding: 8px;
      border-radius: 4px;
      font-size: 13px;
      display: none;
    }
    .status.success {
      background: #2d5016;
      color: #90ee90;
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”§ Stationeers Gas Tuning Helper</h1>

    <div class="instructions">
      <h3>ðŸ“‹ How to use:</h3>
      <ol>
        <li>In Stationeers, hover over gas curves at <strong>25%, 50%, and 75%</strong> of temperature range</li>
        <li>Enter the pressure values (in kPa) you see in the game</li>
        <li>The tool will automatically calculate optimal <code>convexityStart</code> and <code>convexityEnd</code></li>
        <li>Copy the generated <code>gasTuning</code> object and paste it into your code</li>
      </ol>
    </div>

    <div class="gas-grid" id="gasGrid"></div>

    <div class="output-section">
      <h2>ðŸ“¦ Generated gasTuning Object</h2>
      <div class="code-output" id="codeOutput">// Enter pressure values above to generate tuning data</div>
      <button class="copy-button" onclick="copyToClipboard()">ðŸ“‹ Copy to Clipboard</button>
      <div class="status" id="copyStatus">âœ“ Copied to clipboard!</div>
    </div>
  </div>

  <script>
    // Gas data with fixed properties
    const gasData = {
      N2:  { name: 'Nitrogen',        symbol: 'Nâ‚‚',  color: '#444444', meltK: 40,  maxLiqK: 190, minCondKPa: 6.3,  maxKPa: 6000 },
      O2:  { name: 'Oxygen',          symbol: 'Oâ‚‚',  color: '#ffffff', meltK: 56,  maxLiqK: 162, minCondKPa: 6.3,  maxKPa: 6000 },
      H2:  { name: 'Volatiles',       symbol: 'Hâ‚‚',  color: '#ff4444', meltK: 81,  maxLiqK: 195, minCondKPa: 6.3,  maxKPa: 6000 },
      X:   { name: 'Pollutant',       symbol: 'X',   color: '#ffcc00', meltK: 173, maxLiqK: 425, minCondKPa: 1800, maxKPa: 6000 },
      CO2: { name: 'Carbon Dioxide',  symbol: 'COâ‚‚', color: '#888888', meltK: 218, maxLiqK: 265, minCondKPa: 517,  maxKPa: 6000 },
      N2O: { name: 'Nitrous Oxide',   symbol: 'Nâ‚‚O', color: '#44cc44', meltK: 252, maxLiqK: 431, minCondKPa: 800,  maxKPa: 2000 },
      H2O: { name: 'Water',           symbol: 'Hâ‚‚O', color: '#4488ff', meltK: 273, maxLiqK: 643, minCondKPa: 6.3,  maxKPa: 6000 },
    };

    // Default temperature points based on actual game measurements
    // These are the temperatures that work well in the game (avoiding jump issues)
    const defaultTemps = {
      N2:  { t25: 78,  t50: 115, t75: 154 },
      O2:  { t25: 83,  t50: 109, t75: 136 },
      H2:  { t25: 110, t50: 138, t75: 167 },
      X:   { t25: 236, t50: 299, t75: 362 },
      CO2: { t25: 230, t50: 242, t75: 253 },
      N2O: { t25: 297, t50: 342, t75: 387 },
      H2O: { t25: 365, t50: 458, t75: 551 },
    };

    // Calculate temperature at given percentage (fallback)
    function getTempAtPercent(gas, percent) {
      return Math.round(gas.meltK + (gas.maxLiqK - gas.meltK) * percent);
    }

    // Calculate convexity values using least squares method
    function calculateConvexity(gas, p25, p50, p75, temp25, temp50, temp75) {
      // Convert actual temperatures to normalized t values (0-1)
      const t25 = (temp25 - gas.meltK) / (gas.maxLiqK - gas.meltK);
      const t50 = (temp50 - gas.meltK) / (gas.maxLiqK - gas.meltK);
      const t75 = (temp75 - gas.meltK) / (gas.maxLiqK - gas.meltK);

      // Convert pressures to exponents
      const e25 = Math.log(p25 / gas.minCondKPa) / Math.log(gas.maxKPa / gas.minCondKPa);
      const e50 = Math.log(p50 / gas.minCondKPa) / Math.log(gas.maxKPa / gas.minCondKPa);
      const e75 = Math.log(p75 / gas.minCondKPa) / Math.log(gas.maxKPa / gas.minCondKPa);

      // System of equations for least squares fit
      // exponent = (1-t)*(1-t)*t*convexityStart + (1-t)*t*t*convexityEnd + t*t
      // We need to solve for convexityStart and convexityEnd

      // Coefficients for each point
      const a25 = (1 - t25) * (1 - t25) * t25;  // coefficient for convexityStart at 25%
      const b25 = (1 - t25) * t25 * t25;        // coefficient for convexityEnd at 25%
      const c25 = e25 - t25 * t25;              // residual at 25%

      const a50 = (1 - t50) * (1 - t50) * t50;
      const b50 = (1 - t50) * t50 * t50;
      const c50 = e50 - t50 * t50;

      const a75 = (1 - t75) * (1 - t75) * t75;
      const b75 = (1 - t75) * t75 * t75;
      const c75 = e75 - t75 * t75;

      // Least squares solution (normal equations)
      const sumA2 = a25*a25 + a50*a50 + a75*a75;
      const sumB2 = b25*b25 + b50*b50 + b75*b75;
      const sumAB = a25*b25 + a50*b50 + a75*b75;
      const sumAC = a25*c25 + a50*c50 + a75*c75;
      const sumBC = b25*c25 + b50*c50 + b75*c75;

      const det = sumA2 * sumB2 - sumAB * sumAB;

      if (Math.abs(det) < 1e-10) {
        // Fallback: use simple average
        return { start: 0.7, end: 0.7 };
      }

      const convexityStart = (sumB2 * sumAC - sumAB * sumBC) / det;
      const convexityEnd = (sumA2 * sumBC - sumAB * sumAC) / det;

      return {
        start: Math.max(0, Math.min(2, convexityStart)),
        end: Math.max(0, Math.min(2, convexityEnd))
      };
    }

    // Create gas input cards
    function createGasCards() {
      const grid = document.getElementById('gasGrid');

      Object.entries(gasData).forEach(([key, gas]) => {
        // Use actual game-tested temperatures instead of calculated percentages
        const temps = defaultTemps[key];
        const temp25 = temps.t25;
        const temp50 = temps.t50;
        const temp75 = temps.t75;

        const card = document.createElement('div');
        card.className = 'gas-card';
        card.innerHTML = `
          <h2>
            <span class="gas-symbol" style="background: ${gas.color}; color: ${gas.color === '#ffffff' ? '#000' : '#fff'}">${gas.symbol}</span>
            ${gas.name}
          </h2>

          <div class="input-group">
            <label>25% Point (suggested: ${temp25}K / ${temp25 - 273}Â°C)</label>
            <div class="input-row">
              <div class="input-col">
                <label>Pressure</label>
                <div class="input-field">
                  <input type="number" id="${key}-p25" placeholder="Enter pressure" step="0.1" oninput="updateOutput()">
                  <span>kPa</span>
                </div>
              </div>
              <div class="input-col">
                <label>Temperature</label>
                <div class="input-field">
                  <input type="number" id="${key}-t25" value="${temp25}" step="1" oninput="updateOutput()">
                  <span>K</span>
                </div>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label>50% Point (suggested: ${temp50}K / ${temp50 - 273}Â°C)</label>
            <div class="input-row">
              <div class="input-col">
                <label>Pressure</label>
                <div class="input-field">
                  <input type="number" id="${key}-p50" placeholder="Enter pressure" step="0.1" oninput="updateOutput()">
                  <span>kPa</span>
                </div>
              </div>
              <div class="input-col">
                <label>Temperature</label>
                <div class="input-field">
                  <input type="number" id="${key}-t50" value="${temp50}" step="1" oninput="updateOutput()">
                  <span>K</span>
                </div>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label>75% Point (suggested: ${temp75}K / ${temp75 - 273}Â°C)</label>
            <div class="input-row">
              <div class="input-col">
                <label>Pressure</label>
                <div class="input-field">
                  <input type="number" id="${key}-p75" placeholder="Enter pressure" step="0.1" oninput="updateOutput()">
                  <span>kPa</span>
                </div>
              </div>
              <div class="input-col">
                <label>Temperature</label>
                <div class="input-field">
                  <input type="number" id="${key}-t75" value="${temp75}" step="1" oninput="updateOutput()">
                  <span>K</span>
                </div>
              </div>
            </div>
          </div>

          <div class="result">
            <div class="result-label">Calculated Convexity:</div>
            <div class="result-values" id="${key}-result">
              <span>Start: -</span>
              <span>End: -</span>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // Update output code
    function updateOutput() {
      const results = {};
      let hasAnyData = false;

      Object.keys(gasData).forEach(key => {
        const p25 = parseFloat(document.getElementById(`${key}-p25`).value);
        const p50 = parseFloat(document.getElementById(`${key}-p50`).value);
        const p75 = parseFloat(document.getElementById(`${key}-p75`).value);
        const t25 = parseFloat(document.getElementById(`${key}-t25`).value);
        const t50 = parseFloat(document.getElementById(`${key}-t50`).value);
        const t75 = parseFloat(document.getElementById(`${key}-t75`).value);

        if (p25 && p50 && p75 && t25 && t50 && t75) {
          const gas = gasData[key];
          const convexity = calculateConvexity(gas, p25, p50, p75, t25, t50, t75);
          results[key] = convexity;
          hasAnyData = true;

          // Update individual result display
          document.getElementById(`${key}-result`).innerHTML = `
            <span>Start: ${convexity.start.toFixed(3)}</span>
            <span>End: ${convexity.end.toFixed(3)}</span>
          `;
        } else {
          document.getElementById(`${key}-result`).innerHTML = `
            <span>Start: -</span>
            <span>End: -</span>
          `;
        }
      });

      // Generate code output
      if (hasAnyData) {
        let code = 'const gasTuning = {\n';
        Object.entries(gasData).forEach(([key, gas]) => {
          if (results[key]) {
            const { start, end } = results[key];
            code += `  ${key}:  { convexityStart: ${start.toFixed(4)}, convexityEnd: ${end.toFixed(4)} },\n`;
          } else {
            code += `  ${key}:  { convexityStart: 0.5,    convexityEnd: 0.5 },    // Not tuned\n`;
          }
        });
        code += '};';
        document.getElementById('codeOutput').textContent = code;
      } else {
        document.getElementById('codeOutput').textContent = '// Enter pressure values above to generate tuning data';
      }
    }

    // Copy to clipboard
    function copyToClipboard() {
      const code = document.getElementById('codeOutput').textContent;
      navigator.clipboard.writeText(code).then(() => {
        const status = document.getElementById('copyStatus');
        status.style.display = 'block';
        setTimeout(() => {
          status.style.display = 'none';
        }, 2000);
      });
    }

    // Initialize
    createGasCards();
  </script>
</body>
</html>
